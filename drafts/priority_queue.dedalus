% this example was copied from the original Dedalus papers

priority_queue('bob', 'bash', 200)@123;
priority_queue('eve', 'john', 1)@123;
priority_queue('alice', 'ssh', 204)@123;
priority_queue('bob', 'ssh', 205)@123;



% persist[m_priority_queue, del_m_priority_queue, 3]
m_priority_queue(A, B) <- priority_queue(A, B);
m_priority_queue(A, B)@next <-
  m_priority_queue(A, B),
  not del_m_priority_queue(A, B);

% find the min priority
omin(A, min<C>) <-
  m_priority_queue(A, _, C);

% feed p in the next step
% with the items of min priority
p(A, B, C)@next <-
  m_priority_queue(A, B, C),
  omin(A, C);

% delete from the next step
% those items of min priority
del_m_priority_queue(A, B, C) <-
  m_priority_queue(A, B, C),
  omin(A, C);



% Not sure how to test it properly yet.
% Let it just lie here, at least for parsing check.
test_passed;