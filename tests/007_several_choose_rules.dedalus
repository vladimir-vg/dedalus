% checking how severl choose() conditions work together 

book(heinlein, stranger_in_a_strange_land, 1961)@1;
book(heinlein, job_a_comedy_of_justice, 1984)@1;
book(harrison, deathworld, 1960)@1;
book(harrison, the_stainless_steel_rat, 1961)@1;
book(strugatsky, the_way_to_amalthea, 1960)@1;

author(heinlein, usa)@1;
author(harrison, usa)@1;
author(strugatsky, ussr)@1;

select_author(Citizenship, Year, Author) <-
  book(Author, Title, Year),
  author(Author, Citizenship),
  choose((Year), (Author)),
  choose((Citizenship), (Author));

% According to Sergio Greco and Carlo Zaniolo paper
% that was referred in Dedalus paper
% this select_author rule should be converted to something like this:
% 
% select_author(Citizenship, Year, Author) <-
%   'select_author$choose_transformed'(Citizenship, Year, Author);
% 'select_author$choose_transformed'(Citizenship, Year, Author) <-
%   book(Author, Title, Year),
%   author(Author, Citizenship),
%   'select_author$chosen'(Year, Citizenship, Author);
% 'select_author$chosen'(Year, Citizenship, Author) <-
%   book(Author, Title, Year),
%   author(Author, Citizenship),
%   not 'select_author$diff_choice'(Year, Citizenship, Author);
% 'select_author$diff_choice'(Year, Citizenship, Author) <-
%   'select_author$chosen'(Year, Citizenship, AuthorPrime),
%   Author != AuthorPrime;
%
% Basically, I just select all possible values for 'select_author$chosen'
% non-deterministically pick one and assert it as a fact

test_passed(Author) <-
  author(Author, usa),
  select_author(_, 1961, Author);

test_failed <-
  % cannot be true at the same time,
  % since we selecting by year and citizenship
  % row with [usa, 1960] must be unique
  select_author(usa, 1961, heinlein),
  select_author(usa, 1961, harrison);
