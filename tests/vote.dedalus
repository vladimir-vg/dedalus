% adopted code from Overlog example: 
% https://www.mimuw.edu.pl/~ms209495/talks/2011/boom/foil04.html

peer_count(Coordinator, count<Peer>) <-
  peers(Coordinator, Peer);

yes_count(Coordinator, TxnId, count<Peer>) <-
  vote(Coordinator, TxnId, Peer, "yes");

transaction(Coordinator, TxnId, "commit") <-
  peer_count(Coordinator, NumPeers),
  yes_count(Coordinator, TxnId, NumYes),
  transaction(Coordinator, TxnId, "prepare"),
  NumPeers = NumYes;

transaction(Coordinator, TxnId, "abort") <-
  vote(Coordinator, TxnId, _, "no"),
  transaction(Coordinator, TxnId, "prepare");

transaction(#Peer, TxnId, State) <-
  peers(#Coordinator, Peer),
  transaction(#Coordinator, TxnId, State);
